{% extends "base.html" %}
{% block title %}Signup{% endblock title %}
{% load static %}
{% block body %}
<script src="{% static 'sotp.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById("password");
    const requirements = document.getElementById("message");
    const submitButton = document.getElementById("subbtn"); 

    passwordInput.addEventListener("input", function () {
        const valid = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$/.test(passwordInput.value);
        requirements.querySelectorAll("p").forEach((el) => {
            el.classList.toggle("valid", valid);
            el.classList.toggle("invalid", !valid);
        });
    });

    const usernameInput = document.getElementById("username");
    const validationResult = document.getElementById("validationResult");

    usernameInput.addEventListener("input", function () {
        const valid = /^[a-zA-Z0-9_]+$/.test(usernameInput.value);
        validationResult.textContent = valid ? "" : "Invalid username. Only letters, numbers, and underscores are allowed.";
        validationResult.style.color = valid ? "#FF6961" : "#FF6961";
        submitButton.disabled = !valid;
    });


    const signform = document.getElementById("otp-form");
    signform.addEventListener('submit',function(e){
        e.preventDefault();
        const formdata = new FormData(signform);
        fetch("{% url 'signup' %}",{
            method: 'POST',
            body: formdata,
        })
        .then(response => response.json())
        .then(redata => {
            if (redata.msg == "successfull"){
                window.location.replace("{% url 'home'%}");
              }
              else{
                const dmsg = document.getElementById('rmsg');
                dmsg.textContent = redata.msg;
              }
        })
        .catch(error => {
            console.error('Error fetching data:', error);
        });
    });
});
</script>


<h1 class="text-light text-center mb-3 mt-3">Signup Now</h1>
<div class="sub-container text-light mt-5 mb-5" id="sub-container">
    <form id="subForm" method="post">
        {% csrf_token %}
        <div class="mb-3">
            <label for="semail" class="form-label text-light">Enter your Email</label>
            <input style="font-size: larger; font-weight: bold;" type="text" class="form-control text-white bg-transparent" name="semail" id="semail" required></input>
        </div>
        <input type="hidden" name="type" value="signup">
        <div class="d-flex justify-content-center">
            <button id="otpbtn" type="submit" class="btn btn-outline-light text-center mt-2"><b>Verify Email</b></button>
        </div>
    </form>
    <form id="otp-form" method="POST" hidden>
        {% csrf_token %}
        <div class="mb-3">
            <label for="username" class="form-label text-light">Username</label>
            <input style="font-size: larger; font-weight: bold;" type="text" class="form-control text-white bg-transparent" name="username" id="username" required></input>
        </div>
        <p id="validationResult" style="color:#FF6961" class="text-center"></p>
        <div class="mb-3">
            <label for="password" class="form-label text-light">Password</label>
            <input style="font-size: larger; font-weight: bold;" pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$" title="Must contain at least one number, one uppercase and lowercase letter, and at least 8 characters" type="password" class="form-control text-white bg-transparent" name="password" id="password" required></input>
        </div>
        <div class="mb-3">
          <label for="sotp" class="form-label text-light">Enter OTP</label>
          <input style="font-size: larger; font-weight: bold;" type="text" class="form-control text-white bg-transparent" name="sotp" id="sotp" required></input>
        </div>
        <div class="d-flex justify-content-center">
          <button id="subbtn" type="submit" class="btn btn-outline-light text-center mt-2"><b>Signup</b></button>
        </div>
    </form>
    <div class="text-center mt-2" style="color:#FF6961" id="rmsg"></div>
    <div class="text-center mt-2" style="color: aliceblue;" id="otpmsg"></div>
      <div class="loader" id="loader" hidden></div>
        <hr style="border-top: 1px solid #bbb;">
      <p style="text-align: center;"><a class=" link-light link-offset-2 link-underline link-underline-opacity-50" href="{% url 'signin' %}">Already have account? Signin</a></p>
</div>
{% endblock body %}