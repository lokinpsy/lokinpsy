{% extends "base.html" %}
{% block title %}Delete Account{% endblock title %}
{% block body %}
{% load static %}

<style>
    @media screen and (max-width: 600px) {
        .sub-container{
            width: 100%;
            max-width: none;
            padding: 24px;
        }
        #subForm{
            padding: 24px;
        }
    }

    .sub-container{
        margin: auto;
        width: 85%;
        padding: 2%;
        outline: 0.1em solid rgb(9, 64, 91);
        border-radius: 12px;
        box-shadow: 1px 1px 24px rgb(0, 0, 0);
        background-color: rgb(9, 64, 91);
        max-width: 500px;
        padding: 2.3%;
    }

    #subForm{
        padding: 24px;
    }

    #loader {
        border: 2px solid #f3f3f3; /* Light grey */
        border-top: 2px solid #3498db; /* Blue */
        border-radius: 50%;
        width: 12px;
        height: 12px;
        animation: spin 2s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

</style>

<script src="{% static 'sotp.js' %}"></script>
<script>     
    function showPass() {
        var x = document.getElementById("password");
        if (x.type === "password") {
          x.type = "text";
          document.getElementById("ens").hidden = true;
          document.getElementById("es").hidden = false;
        } else {
          x.type = "password";
          document.getElementById("ens").hidden = false;
          document.getElementById("es").hidden = true;
        }
      }

    document.addEventListener('DOMContentLoaded', function() { 

    const signform = document.getElementById("otp-form");
    signform.addEventListener('submit',function(e){
        e.preventDefault();
        const formdata = new FormData(signform);
        fetch("{% url 'del_acc' %}",{
            method: 'POST',
            body: formdata,
        })
        .then(response => response.json())
        .then(redata => {
            if (redata.message == "success"){
                window.location.replace("{% url 'home'%}");
                }
                else{
                const dmsg = document.getElementById('rmsg');
                dmsg.textContent = redata.message;
                messageDiv.hidden = true;
                loader.hidden = true;
                }
        })
        .catch(error => {
            console.error('Error fetching data:', error);
        });
    });
});
</script>

<div id="subcon" class="subcon mb-5">
    <div class="mb-5" style="padding-top: 35px; margin-bottom: 25px;">
      <h1 class='text-danger text-center mb-2 mt-5'> <strong>Delete Account</strong></h1>
      <p class="text-center text-secondary mb-5"><strong>Caution: </strong>You won't receive any furthur updates. All of your data will be deleted</p>
    </div>
    <div class="sub-container mt-4" id='sub-container'>
      <form id="subForm" method="post">
        {% csrf_token %}
        <div class="mb-3">
          <label for="semail" class="form-label text-light">Enter your Email</label>
          <input style="font-size: larger; font-weight: bold;" type="email" class="form-control text-white bg-transparent" name="semail" id="semail" required></input>
        </div>
        <input type="hidden" name="type" value="delacc">
        <div class="d-flex justify-content-center">
            <button id="otpbtn" type="submit" class="btn btn-outline-light text-center mt-2"><b>Verify Email</b></button>
        </div>
      </form>
      <!-- OTP Form -->
      <form id="otp-form" method="post" hidden>
        {% csrf_token %}
        <div class="mb-3">
            <label for="sersn" class="form-label text-light">Reason for Unsubscribing</label>
            <select class="form-control text-white bg-transparent" name="sersn" id="sersn" required>
                <option class="text-secondary bg-dark" value="" disabled selected>-- Select a reason --</option>
                <option class="text-light bg-dark" value="Bad Content">Bad Content</option>
                <option class="text-light bg-dark" value="Not enough post">Not enough posts</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="exampleFormControlTextarea1" class="form-label text-light">Message (optional)</label>
            <textarea class="form-control text-white bg-transparent" name="sersnmsg" id="sersnmsg" rows="3"></textarea>
        </div>
        <label for="password" class="form-label text-light">Password</label>
        <div class="input-group mb-3">
            <input pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$" title="Must contain at least one number, one uppercase and lowercase letter, and at least 8 characters" style="font-size: larger; font-weight: bold;" type="password" class="form-control text-white bg-transparent" name="password" id="password" required></input>
            <span class="input-group-text bg-dark" id="basic-addon1">
                <button type="button" class="btn btn-dark" onclick="showPass()">
                    <i class="bi bi-eye" id='ens'></i>
                    <i class="bi bi-eye-slash" hidden id='es'></i>
                </button>
            </span>
        </div>
        <div class="mb-3">
          <label for="sotp" class="form-label text-light">Enter OTP</label>
          <input pattern = "\d{6}" title="OTP should be a 6-digit number" style="font-size: larger; font-weight: bold;" type="text" class="form-control text-white bg-transparent" name="sotp" id="sotp" required></input>
        </div>
        <div class="d-flex justify-content-center">
          <button id="subbtn" type="submit" class="btn btn-outline-danger text-center mt-2"><b>Delete Account</b></button>
        </div>
      </form>
      <div class="text-center mt-2" style="color:#FF6961" id="rmsg"></div>
      <div class="text-center mt-2" style="color: aliceblue;" id="otpmsg"></div>
      <div class="loader" id="loader" hidden></div>
    </div>
</div>
{% endblock body %}