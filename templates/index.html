{%extends 'base.html' %}
{%load static%}


<title>{%block title%}Home{%endblock%}</title>

{%block body%}

<style>
    .container-bg {
        background-color: rgb(9, 64, 91);
        height: 500px;
        z-index: -1;
    }

    .name{
      font-size: 64px;
      color:white;
      position: absolute;
      top: 35%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 3;
    }

    .tagline{
      font-size: 20px;
      color: rgb(202, 202, 202);
      position: absolute;
      top: 45%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 3;
    }

    #search-form {
        position: absolute;
        top: 65%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 3;
    }

    @media screen and (max-width: 600px) {
      .name {
        font-size: 30px;
        position: absolute;
        top: 25%;
      }
      .tagline {
        font-size: 12px;
        position: absolute;
        top:30%;
      }
      #search-form{
        position: absolute;
        top: 55%;
      }
      .container-bg{
        height: 400px;
      }
    }

    .post-container{
        margin-top: -100px;
        margin-left: 40px;
        margin-right: 40px;
        margin-bottom: 40px;
    }

    #postcol{
      box-shadow: 1px 2px 3px 2px rgba(0, 0, 0, 0.5);
    }
    .sub-container{
        margin: auto;
        width: 55%;
        padding: 2%;
        outline: 0.1em solid rgb(9, 64, 91);
        border-radius: 12px;
        box-shadow: 1px 1px 24px rgb(0, 0, 0);
        background-color: rgb(9, 64, 91);
        max-width: 500px;
        padding-top: 2.3%;
    }
    .subcon{
      background-color: rgb(65, 67, 68);
      height: 500px;
    }

</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const subForm = document.getElementById('subForm');
    const messageDiv = document.getElementById('otpmsg');
    const otpform = document.getElementById('otp-form');
    const subcon = document.getElementById('sub-container');

    subForm.addEventListener('submit', function(e) {
        e.preventDefault(); // Prevent default form submission

        const formData = new FormData(subForm);
        messageDiv.textContent = 'Sending OTP'

        subcon.style.backgroundColor = 'rgb(9, 64, 91)'

        fetch("{% url 'sotp' %}", {
            method: 'POST',
            body: formData,
        })
        .then(response => response.json())
        .then(data => {
          if (data.message == "OTP sent successfully") {
                messageDiv.textContent = data.message;
                subForm.hidden = true;
                otpform.hidden = false; 
          } else {
            messageDiv.textContent = "Email already used";
            subcon.style.backgroundColor = '#FF6961';
          }
        })
        .catch(error => {
            console.error('Error fetching data:', error);
        });
    });
});

</script>

<body>
    {% include "message.html" %}
    <div class="container-bg">
        <div class="overlay">
        </div>
        <h1 class="name">Lokin Psy</h1>
        <h5 class="tagline">Psychology in Nutshell</h5>
    </div>
    <!-- Search Section -->

    <form action="search" id="search-form" class="row g-2">
        <div class="d-grid gap-2">
          <input style="font-weight: bold;" class="form-control form-control-lg" type="text" placeholder="Search topic" name='searchquery' id='searchquery'>
        </div>
        <div class="d-grid gap-2 col-3 mx-auto">
          <button type="submit" class="btn btn-outline-light my-1 mb-5"><b>Search</b></button>
        </div>
      </form>
    
    <!-- Post section -->
    <div class="container">
      {% for post in posts %}
        {% if forloop.counter0|divisibleby:3 %}
          <div class="row row-cols-1 row-cols-md-3 g-4 mt-5 mb-3">
        {% endif %}
        <div class="col">
          <a style="text-decoration: none;" href="{% url 'post' post.id %}">
            <div id="postcol" class="card h-100 text-bg-dark">
              <img src="{{ post.images.url }}" class="card-img-top" style="height: 300px" alt="...">
              <div class="card-body">
                <h5 class="card-title">{{ post.title }}</h5>
                <p class="card-text">{{ post.intro }}</p>
                <p class="card-text">{{ post.category }}</p>
              </div>
              <div class="card-footer">
                <small class="text-body-secondary-dark">Published on {{ post.pub_date.date }}</small>
              </div>
            </div>
          </a>
        </div>
        {% if forloop.counter0|add:1|divisibleby:3 or forloop.last %}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  
    <!-- Pagination -->
    <hr>
    <nav aria-label="Page navigation example" style="text-align: center;">
      <ul class="pagination justify-content-center">
          {% if posts.has_previous %}
              <li class="page-item"><a class="page-link bg-dark text-white" href="?page=1">First</a></li>
              <li class="page-item"><a class="page-link bg-dark text-white" href="?page={{posts.previous_page_number}}">Previous</a></li>
          {% endif%}
          <li class="page-item"><a class="page-link bg-dark text-white">{{posts.number}}</a></li>
          {% if posts.has_next %}
              <li class="page-item"><a class="page-link bg-dark text-white" href="?page={{posts.next_page_number}}">Next</a></li>
              <li class="page-item"><a class="page-link bg-dark text-white" href="?page={{posts.paginator.num_pages}}">Last</a></li>
          {% endif%}
      </ul>
    </nav>
    
    <!-- Subscribe for free -->
    <hr>
    <div id="subcon" class="subcon">
      <div class="mb-5" style="padding-top: 35px; margin-bottom: 25px;">
        <h1 class='text-light text-center mb-2 mt-5'> Subscribe Now</h1>
        <p class="text-center text-secondary mb-5">Get email notification for every new post. Don't worry it's free!!</p>
      </div>
      <div class="sub-container mt-4" id='sub-container'>
        <form id="subForm" method="post">
          {% csrf_token %}
          <div class="mb-3">
            <label for="semail" class="form-label text-light">Enter your Email</label>
            <input style="font-size: larger; font-weight: bold;" type="text" class="form-control text-white bg-transparent" name="semail" id="semail" required></input>
          </div>
          <div class="d-flex justify-content-center">
            <button id="otpbtn" type="submit" class="btn btn-outline-light text-center mt-2"><b>Verify Email</b></button>
          </div>
        </form>
        <!-- OTP Form -->
        <form id="otp-form" action="subscribe" method="post" hidden>
          {% csrf_token %}
          <div class="mb-3">
            <label for="sotp" class="form-label text-light">Enter OTP</label>
            <input style="font-size: larger; font-weight: bold;" type="text" class="form-control text-white bg-transparent" name="sotp" id="sotp" required></input>
          </div>
          <div class="d-flex justify-content-center">
            <button id="subbtn" type="submit" class="btn btn-outline-light text-center mt-2"><b>Subscribe</b></button>
          </div>
        </form>
        <div class="text-center mt-2" style="color: aliceblue;" id="otpmsg"></div>
      </div>
    </div>

</body>

</html>

{%endblock%}